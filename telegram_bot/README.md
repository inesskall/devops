# Telegram Bot для бронирования событий

Telegram бот для просмотра и бронирования событий через API Event Booking.

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Создайте бота в Telegram:
   - Откройте [@BotFather](https://t.me/BotFather) в Telegram
   - Отправьте команду `/newbot`
   - Следуйте инструкциям для создания бота
   - Сохраните полученный токен

3. Настройте переменные окружения:
   - Скопируйте `.env.example` в `.env`
   - Заполните `TELEGRAM_BOT_TOKEN` вашим токеном от BotFather
   - При необходимости измените `API_BASE_URL` (по умолчанию `http://localhost:8080/api/v1`)

## Запуск

Убедитесь, что Spring Boot приложение запущено и доступно по адресу, указанному в `API_BASE_URL`.

### Способ 1: Использование скрипта (рекомендуется)

```bash
cd telegram_bot
./start_bot.sh
```

### Способ 2: Прямой запуск

```bash
cd telegram_bot
python3 bot.py
```

### Способ 3: Запуск в фоновом режиме

```bash
cd telegram_bot
nohup python3 bot.py > bot.log 2>&1 &
```

## Остановка бота

### Способ 1: Использование скрипта (рекомендуется)

```bash
cd telegram_bot
./stop_bot.sh
```

### Способ 2: Остановка через процесс

Найдите процесс бота:
```bash
ps aux | grep "python3.*bot.py"
```

Остановите бота (замените `PID` на номер процесса):
```bash
kill PID
```

Или принудительно:
```bash
pkill -f "python3.*bot.py"
```

### Способ 3: Если бот запущен в текущем терминале

Нажмите `Ctrl+C` для остановки.

## Использование

После запуска бота, найдите его в Telegram и отправьте команду `/start`.

### Первый запуск

При первом использовании бота необходимо зарегистрироваться или войти в существующий аккаунт:

1. **Регистрация** (`/register`):
   - Введите ваше имя
   - Введите вашу фамилию
   - Введите Student ID
   - Введите пароль (минимум 4 символа)

2. **Вход** (`/login`):
   - Введите ваш Student ID
   - Введите ваш пароль

### Доступные команды:

**Основные команды:**
- `/start` - Начать работу с ботом
- `/help` - Показать справку
- `/register` - Регистрация нового аккаунта
- `/login` - Вход в существующий аккаунт
- `/logout` - Выйти из аккаунта

**Команды для работы с событиями (требуют авторизации):**
- `/events` - Показать список всех событий
- `/event <id>` - Показать детали конкретного события
- `/book` - Начать процесс бронирования события
- `/my_reservations` - Показать мои бронирования
- `/cancel` - Отменить текущую операцию

### Меню команд

В Telegram бот имеет меню команд (кнопка рядом со стикером), где доступны все основные команды для быстрого доступа.

### Процесс бронирования:

1. Убедитесь, что вы авторизованы (`/login` или `/register`)
2. Используйте команду `/events` для просмотра доступных событий
3. Выберите событие и нажмите кнопку "Забронировать" или используйте `/book`
4. Введите ID события (если не использовали кнопку)
5. Если пароль не сохранен, введите пароль для подтверждения
6. Бронирование будет создано автоматически

## Структура проекта

```
telegram_bot/
├── bot.py              # Основной файл бота
├── api_client.py        # Клиент для работы с API
├── config.py           # Конфигурация
├── requirements.txt    # Зависимости Python
├── start_bot.sh        # Скрипт для запуска бота
├── stop_bot.sh         # Скрипт для остановки бота
├── .env.example        # Пример файла с переменными окружения
└── README.md          # Этот файл
```

## Требования

- Python 3.8+
- Запущенное Spring Boot приложение
- Токен Telegram бота от @BotFather

