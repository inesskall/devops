#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Telegram –±–æ—Ç–∞

cd "$(dirname "$0")"

echo "üöÄ –ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞..."
echo "üìÅ –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $(pwd)"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ .env —Ñ–∞–π–ª–∞
if [ ! -f .env ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: —Ñ–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    echo "–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –∏–∑ .env.example –∏ —É–∫–∞–∂–∏—Ç–µ TELEGRAM_BOT_TOKEN"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Python
if ! command -v python3 &> /dev/null; then
    echo "‚ùå –û—à–∏–±–∫–∞: Python3 –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø—É—â–µ–Ω –ª–∏ —É–∂–µ –±–æ—Ç
if pgrep -f "python3.*bot.py" > /dev/null; then
    echo "‚ö†Ô∏è  –ë–æ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω!"
    echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ./stop_bot.sh –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏"
    exit 1
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
echo "‚úÖ –ó–∞–ø—É—Å–∫–∞—é –±–æ—Ç–∞..."
python3 bot.py

